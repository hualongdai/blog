{
  "html": "<p>写EventEmitter 应该注意的点</p>",
  "content": "写EventEmitter 应该注意的点",
  "custom_ranking": {
    "position": 0,
    "heading": 100
  },
  "draft": false,
  "categories": [
    "JS基础"
  ],
  "layout": "post",
  "comments": true,
  "title": "EventEmitter with ES6",
  "tag": [
    "EventEmitter",
    "ES6"
  ],
  "ext": ".md",
  "tags": [
    "EventEmitter",
    "ES6"
  ],
  "date": 1470758400,
  "excerpt_html": "<p>写EventEmitter 应该注意的点</p>  <figure class=\"highlight\"><pre><code class=\"language-javascript\" data-lang=\"javascript\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1<br data-jekyll-commonmark-ghpages=\"\" />2<br data-jekyll-commonmark-ghpages=\"\" />3<br data-jekyll-commonmark-ghpages=\"\" />4<br data-jekyll-commonmark-ghpages=\"\" />5<br data-jekyll-commonmark-ghpages=\"\" />6<br data-jekyll-commonmark-ghpages=\"\" />7<br data-jekyll-commonmark-ghpages=\"\" />8<br data-jekyll-commonmark-ghpages=\"\" />9<br data-jekyll-commonmark-ghpages=\"\" />10<br data-jekyll-commonmark-ghpages=\"\" />11<br data-jekyll-commonmark-ghpages=\"\" />12<br data-jekyll-commonmark-ghpages=\"\" />13<br data-jekyll-commonmark-ghpages=\"\" />14<br data-jekyll-commonmark-ghpages=\"\" />15<br data-jekyll-commonmark-ghpages=\"\" />16<br data-jekyll-commonmark-ghpages=\"\" />17<br data-jekyll-commonmark-ghpages=\"\" />18<br data-jekyll-commonmark-ghpages=\"\" />19<br data-jekyll-commonmark-ghpages=\"\" />20<br data-jekyll-commonmark-ghpages=\"\" />21<br data-jekyll-commonmark-ghpages=\"\" />22<br data-jekyll-commonmark-ghpages=\"\" />23<br data-jekyll-commonmark-ghpages=\"\" />24<br data-jekyll-commonmark-ghpages=\"\" />25<br data-jekyll-commonmark-ghpages=\"\" />26<br data-jekyll-commonmark-ghpages=\"\" />27<br data-jekyll-commonmark-ghpages=\"\" />28<br data-jekyll-commonmark-ghpages=\"\" />29<br data-jekyll-commonmark-ghpages=\"\" />30<br data-jekyll-commonmark-ghpages=\"\" />31<br data-jekyll-commonmark-ghpages=\"\" />32<br data-jekyll-commonmark-ghpages=\"\" />33<br data-jekyll-commonmark-ghpages=\"\" />34<br data-jekyll-commonmark-ghpages=\"\" />35<br data-jekyll-commonmark-ghpages=\"\" />36<br data-jekyll-commonmark-ghpages=\"\" />37<br data-jekyll-commonmark-ghpages=\"\" />38<br data-jekyll-commonmark-ghpages=\"\" />39<br data-jekyll-commonmark-ghpages=\"\" />40<br data-jekyll-commonmark-ghpages=\"\" />41<br data-jekyll-commonmark-ghpages=\"\" />42<br data-jekyll-commonmark-ghpages=\"\" />43<br data-jekyll-commonmark-ghpages=\"\" />44<br data-jekyll-commonmark-ghpages=\"\" />45<br data-jekyll-commonmark-ghpages=\"\" />46<br data-jekyll-commonmark-ghpages=\"\" />47<br data-jekyll-commonmark-ghpages=\"\" />48<br data-jekyll-commonmark-ghpages=\"\" />49<br data-jekyll-commonmark-ghpages=\"\" />50<br data-jekyll-commonmark-ghpages=\"\" /></pre></td><td class=\"code\"><pre><span class=\"cm\">/* eslint-disable no-console */</span><br data-jekyll-commonmark-ghpages=\"\" /><span class=\"kd\">const</span> <span class=\"nx\">warn</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">msg</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span> <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">warn</span><span class=\"p\">(</span><span class=\"nx\">msg</span><span class=\"p\">);</span> <span class=\"p\">};</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" /><span class=\"kd\">class</span> <span class=\"nx\">EventEmitter</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"kd\">constructor</span><span class=\"p\">()</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span> <span class=\"o\">=</span> <span class=\"p\">{};</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"nx\">on</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">)</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">event</span> <span class=\"o\">!==</span> <span class=\"s1\">'string'</span><span class=\"p\">)</span> <span class=\"nx\">warn</span><span class=\"p\">(</span><span class=\"s1\">'event must be type of string'</span><span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">callback</span> <span class=\"o\">!==</span> <span class=\"s1\">'function'</span><span class=\"p\">)</span> <span class=\"nx\">warn</span><span class=\"p\">(</span><span class=\"s1\">'callback must be type of function'</span><span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">scope</span> <span class=\"o\">!==</span> <span class=\"s1\">'object'</span><span class=\"p\">)</span> <span class=\"nx\">warn</span><span class=\"p\">(</span><span class=\"s1\">'scope must be type of object'</span><span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">]</span> <span class=\"o\">||</span> <span class=\"p\">[];</span><br data-jekyll-commonmark-ghpages=\"\" />        <span class=\"c1\">// 这里必须要加 改事件回调是否已经注册过 的判断，你可以去掉试试，</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">isExistedCallbackByEvent</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span><span class=\"p\">))</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">].</span><span class=\"nx\">push</span><span class=\"p\">({</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span> <span class=\"p\">});</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"nx\">isExistedCallbackByEvent</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span><span class=\"p\">)</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">]</span> <span class=\"o\">&amp;&amp;</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">]</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"p\">.</span><span class=\"nx\">filter</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"o\">=&gt;</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t<span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">scope</span> <span class=\"o\">===</span> <span class=\"nx\">scope</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">()</span> <span class=\"o\">===</span> <span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"p\">).</span><span class=\"nx\">length</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">;</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"nx\">off</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span><span class=\"p\">)</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">])</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t<span class=\"k\">if</span> <span class=\"p\">((</span><span class=\"nx\">callback</span> <span class=\"o\">||</span> <span class=\"nx\">scope</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">isExistedCallbackByEvent</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span> <span class=\"nx\">callback</span><span class=\"p\">,</span> <span class=\"nx\">scope</span><span class=\"p\">))</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">].</span><span class=\"nx\">filter</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"o\">=&gt;</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t\t\t<span class=\"p\">(</span><span class=\"nx\">callback</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">()</span> <span class=\"o\">!==</span> <span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">())</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t\t\t<span class=\"o\">||</span> <span class=\"p\">(</span><span class=\"nx\">scope</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">scope</span> <span class=\"o\">!==</span> <span class=\"nx\">scope</span><span class=\"p\">),</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t\t<span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">event</span><span class=\"p\">].</span><span class=\"nx\">length</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"nx\">emit</span><span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">{</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"kr\">arguments</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">===</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"nx\">warn</span><span class=\"p\">(</span><span class=\"s1\">'trigger method need at least one parameter'</span><span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"kd\">const</span> <span class=\"nx\">key</span> <span class=\"o\">=</span> <span class=\"nx\">args</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"kd\">const</span> <span class=\"nx\">restArgs</span> <span class=\"o\">=</span> <span class=\"p\">[].</span><span class=\"nx\">slice</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"nx\">args</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">);</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">])</span> <span class=\"k\">return</span><span class=\"p\">;</span><br data-jekyll-commonmark-ghpages=\"\" />\t\t<span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">[</span><span class=\"nx\">key</span><span class=\"p\">].</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">callback</span><span class=\"p\">.</span><span class=\"nx\">apply</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">scope</span> <span class=\"o\">||</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"nx\">restArgs</span><span class=\"p\">));</span><br data-jekyll-commonmark-ghpages=\"\" />\t<span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><span class=\"p\">}</span><br data-jekyll-commonmark-ghpages=\"\" /><br data-jekyll-commonmark-ghpages=\"\" /><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"k\">new</span> <span class=\"nx\">EventEmitter</span><span class=\"p\">();</span></pre></td></tr></tbody></table></code></pre></figure>",
  "excerpt_text": "写EventEmitter 应该注意的点 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/* eslint-disable no-console */const warn = (msg) => { console.warn(msg); };class EventEmitter {\tconstructor() {\t\tthis.events = {};\t}\ton(event, callback, scope = null) {\t\tif (typeof event !== 'string') warn('event must be type of string');\t\tif (typeof callback !== 'function') warn('callback must be type of function');\t\tif (typeof scope !== 'object') warn('scope must be type of object');\t\tthis.events[event] = this.events[event] || []; // 这里必须要加 改事件回调是否已经注册过 的判断，你可以去掉试试，\t\tif (!this.isExistedCallbackByEvent(event, callback, scope)) {\t\t\tthis.events[event].push({ callback, scope });\t\t}\t}\tisExistedCallbackByEvent(event, callback, scope) {\t\treturn this.events[event] && this.events[event]\t\t.filter(item =>\t\t\titem.scope === scope && item.callback.toString() === callback.toString(),\t\t).length > 0;\t}\toff(event, callback, scope) {\t\tif (this.events[event]) {\t\t\tif ((callback || scope) && this.isExistedCallbackByEvent(event, callback, scope)) {\t\t\t\tthis.events[event] = this.events[event].filter(item =>\t\t\t\t\t(callback && item.callback.toString() !== callback.toString())\t\t\t\t\t|| (scope && item.scope !== scope),\t\t\t\t);\t\t\t} else {\t\t\t\tthis.events[event].length = 0;\t\t\t}\t\t}\t}\temit(...args) {\t\tif (arguments.length === 0) warn('trigger method need at least one parameter');\t\tconst key = args[0];\t\tconst restArgs = [].slice.call(args, 1);\t\tif (!this.events[key]) return;\t\tthis.events[key].forEach(item => item.callback.apply(item.scope || null, restArgs));\t}}export default new EventEmitter();",
  "slug": "EventEmitter",
  "type": "post",
  "url": "/js%E5%9F%BA%E7%A1%80/2016/08/10/EventEmitter/",
  "objectID": "c4ee6c40b2d3ce682434e4e9f041865d"
}